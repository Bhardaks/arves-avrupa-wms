<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wix Entegrasyon Test</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <style>
    /* Dropdown Navigation Styles */
    .main-nav {
      display: flex;
      align-items: center;
      gap: 0;
      background: var(--header-bg, #1e293b);
    }
    
    .nav-link.standalone {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      text-decoration: none;
      color: var(--header-fg, #e2e8f0);
      transition: all 0.2s ease;
      border-right: 1px solid rgba(255,255,255,0.1);
    }
    
    .nav-link.standalone:hover {
      background: rgba(255,255,255,0.1);
      color: var(--accent, #3b82f6);
    }
    
    .nav-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .nav-dropdown-trigger {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      cursor: pointer;
      color: var(--header-fg, #e2e8f0);
      transition: all 0.2s ease;
      border-right: 1px solid rgba(255,255,255,0.1);
      user-select: none;
    }
    
    .nav-dropdown-trigger:hover {
      background: rgba(255,255,255,0.1);
      color: var(--accent, #3b82f6);
    }
    
    .nav-dropdown:hover .nav-dropdown-trigger {
      background: rgba(255,255,255,0.1);
      color: var(--accent, #3b82f6);
    }
    
    .dropdown-arrow {
      margin-left: 8px;
      font-size: 10px;
      transition: transform 0.2s ease;
    }
    
    .nav-dropdown:hover .dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .nav-dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 220px;
      background: var(--card, #ffffff);
      border: 1px solid var(--border, #e5e7eb);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 1000;
      overflow: hidden;
    }
    
    .nav-dropdown:hover .nav-dropdown-content {
      display: block;
      animation: dropdownFadeIn 0.2s ease;
    }
    
    @keyframes dropdownFadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .nav-dropdown-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      text-decoration: none;
      color: var(--fg, #374151);
      transition: all 0.2s ease;
      border-bottom: 1px solid var(--border, #f3f4f6);
    }
    
    .nav-dropdown-link:last-child {
      border-bottom: none;
    }
    
    .nav-dropdown-link:hover {
      background: var(--hover, #f8fafc);
      color: var(--accent, #3b82f6);
    }
    
    .nav-icon {
      margin-right: 10px;
      font-size: 16px;
    }
    
    .nav-text {
      font-weight: 500;
      font-size: 14px;
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .main-nav {
        display: none;
      }
    }
    
    .test-section {
      background: rgba(31,42,68,0.3);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .test-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 500px;
    }
    
    .test-form input, .test-form select, .test-form button {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--fg);
      font-size: 14px;
    }
    
    .test-form button {
      background: var(--accent);
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .test-form button:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }
    
    .test-form button:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .result.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid #22c55e;
      color: #22c55e;
    }
    
    .result.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid #ef4444;
      color: #ef4444;
    }
    
    .wix-orders {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .order-card {
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 12px;
      margin: 8px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .order-card:hover {
      border-color: var(--accent);
      background: rgba(31,42,68,0.5);
    }
    
    .order-card.has-wix-id {
      border-left: 4px solid #22c55e;
    }
    
    .order-card.no-wix-id {
      border-left: 4px solid #ef4444;
    }
    
    .order-number {
      font-weight: bold;
      color: var(--accent);
      font-size: 16px;
    }
    
    .order-details {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
    }
    
    .wix-id {
      font-family: 'Courier New', monospace;
      background: rgba(0,0,0,0.3);
      padding: 2px 6px;
      border-radius: 3px;
      margin-top: 4px;
      display: inline-block;
    }
  </style>
</head>
<body>
<header>
  <div class="header-brand">
    <h1>WMS Netsis Entegre</h1>
    <span class="header-subtitle">Wix Entegrasyon Test</span>
  </div>
  <div class="header-user">
    <div class="user-info" id="userInfo" style="display: none;">
      <span class="user-name" id="userName"></span>
      <span class="user-role" id="userRole"></span>
      <button class="logout-btn" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>
  <nav class="main-nav">
    <!-- Ana Sayfa linki -->
    <a href="/index.html" class="nav-link standalone">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-text">Ana Sayfa</span>
    </a>
    
    <!-- Ana ModÃ¼ller Dropdown -->
    <div class="nav-dropdown">
      <div class="nav-dropdown-trigger">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Ana ModÃ¼ller</span>
        <span class="dropdown-arrow">â–¼</span>
      </div>
      <div class="nav-dropdown-content">
        <a href="/products.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“¦</span>
          <span class="nav-text">ÃœrÃ¼nler</span>
        </a>
        <a href="/orders.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">SipariÅŸler</span>
        </a>
        <a href="/delivery-confirmation.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸšš</span>
          <span class="nav-text">Teslimat Ä°ÅŸlemleri</span>
        </a>
      </div>
    </div>
    
    <!-- Raf YÃ¶netimi Dropdown -->
    <div class="nav-dropdown">
      <div class="nav-dropdown-trigger">
        <span class="nav-icon">ğŸ¬</span>
        <span class="nav-text">Raf YÃ¶netimi</span>
        <span class="dropdown-arrow">â–¼</span>
      </div>
      <div class="nav-dropdown-content">
        <a href="/shelf-scanner.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-text">Rafa Dizim</span>
        </a>
        <a href="/shelf-locations.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">Lokasyonlar</span>
        </a>
        <a href="/shelf-admin.html" class="nav-dropdown-link">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">Raf YÃ¶netimi</span>
        </a>
        <a href="/shelf-transfer.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ”„</span>
          <span class="nav-text">Raflar ArasÄ± Transfer</span>
        </a>
        <a href="/inventory-count.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Depo SayÄ±m</span>
        </a>
        <a href="/stock-management.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-text">Stok YÃ¶netimi</span>
        </a>
      </div>
    </div>
    
    <!-- SSH Servis Dropdown -->
    <div class="nav-dropdown">
      <div class="nav-dropdown-trigger">
        <span class="nav-icon">ğŸ”§</span>
        <span class="nav-text">SSH Servis</span>
        <span class="dropdown-arrow">â–¼</span>
      </div>
      <div class="nav-dropdown-content">
        <a href="/service-request.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ”§</span>
          <span class="nav-text">Servis Talep</span>
        </a>
        <a href="/service-dashboard.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Servis Dashboard</span>
        </a>
        <a href="/ssh-inventory.html" class="nav-dropdown-link">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">SSH Envanter</span>
        </a>
      </div>
    </div>
  </nav>
  <div id="mobileNav" class="mobile-nav">
    <button id="mobileNavToggle" class="mobile-nav-toggle">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    <div id="mobileNavMenu" class="mobile-nav-menu">
      <div class="mobile-nav-header">
        <h3>WMS Sistemi</h3>
      </div>
      <div class="mobile-nav-group">
        <span class="mobile-nav-group-label">Ana ModÃ¼ller</span>
        <a href="/index.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-text">Ana Sayfa</span>
        </a>
        <a href="/products.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“¦</span>
          <span class="nav-text">ÃœrÃ¼nler</span>
        </a>
        <a href="/orders.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">SipariÅŸler</span>
        </a>
        <a href="/delivery-confirmation.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸšš</span>
          <span class="nav-text">Teslimat Ä°ÅŸlemleri</span>
        </a>
      </div>
      <div class="mobile-nav-group">
        <span class="mobile-nav-group-label">Raf YÃ¶netimi</span>
        <a href="/shelf-scanner.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-text">Rafa Dizim</span>
        </a>
        <a href="/shelf-locations.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">Lokasyonlar</span>
        </a>
        <a href="/shelf-admin.html" class="mobile-nav-link">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">Raf YÃ¶netimi</span>
        </a>
        <a href="/shelf-transfer.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ”„</span>
          <span class="nav-text">Raflar ArasÄ± Transfer</span>
        </a>
        <a href="/inventory-count.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Depo SayÄ±m</span>
        </a>
      </div>
      <div class="mobile-nav-group">
        <span class="mobile-nav-group-label">SSH Servis</span>
        <a href="/service-request.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ”§</span>
          <span class="nav-text">Servis Talep</span>
        </a>
        <a href="/service-dashboard.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Servis Dashboard</span>
        </a>
        <a href="/ssh-inventory.html" class="mobile-nav-link">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">SSH Envanter</span>
        </a>
      </div>
    </div>
  </div>
</header>

<main style="max-width:1200px;margin:auto;padding:20px;">
  
  <div class="test-section">
    <h2>ğŸ“‹ WMS SipariÅŸleri (Wix ID KontrolÃ¼)</h2>
    <button id="loadOrders" class="btn">SipariÅŸleri YÃ¼kle</button>
    <div id="ordersResult"></div>
  </div>
  
  <div class="test-section">
    <h2>ğŸ§ª Manuel Wix Fulfillment Test</h2>
    <form class="test-form" id="wixTestForm">
      <input type="text" id="orderId" placeholder="Wix Order ID" required />
      <select id="fulfillmentStatus" required>
        <option value="">Fulfillment Status SeÃ§in</option>
        <option value="NOT_FULFILLED">NOT_FULFILLED</option>
        <option value="PARTIALLY_FULFILLED">PARTIALLY_FULFILLED</option>
        <option value="FULFILLED">FULFILLED</option>
      </select>
      <button type="submit">Wix'te GÃ¼ncelle</button>
    </form>
    <div id="testResult"></div>
  </div>
  
  <div class="test-section">
    <h2>ğŸ”„ WMS SipariÅŸ Durumu Test</h2>
    <p>Bir WMS sipariÅŸinin durumunu deÄŸiÅŸtirin ve Wix'te otomatik gÃ¼ncellenip gÃ¼ncellenmedÄŸini kontrol edin.</p>
    <div id="wmsOrdersContainer" class="wix-orders"></div>
  </div>

</main>

<script>
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

// Load WMS orders with Wix ID info
async function loadWMSOrders() {
  try {
    $('#loadOrders').disabled = true;
    $('#loadOrders').textContent = 'YÃ¼kleniyor...';
    
    const response = await fetch('/api/orders');
    const orders = await response.json();
    
    console.log('ğŸ“‹ WMS Orders loaded:', orders.length);
    
    const hasWixId = orders.filter(o => o.wix_order_id);
    const noWixId = orders.filter(o => !o.wix_order_id);
    
    const ordersHtml = `
      <div style="margin: 15px 0;">
        <strong>Toplam:</strong> ${orders.length} sipariÅŸ<br>
        <span style="color: #22c55e;">âœ… Wix ID'si olan:</span> ${hasWixId.length}<br>
        <span style="color: #ef4444;">âŒ Wix ID'si olmayan:</span> ${noWixId.length}
      </div>
      <div class="wix-orders">
        ${orders.map(order => `
          <div class="order-card ${order.wix_order_id ? 'has-wix-id' : 'no-wix-id'}" onclick="selectOrder('${order.id}', '${order.order_number}', '${order.wix_order_id || ''}')">
            <div class="order-number">${order.order_number}</div>
            <div class="order-details">
              MÃ¼ÅŸteri: ${order.customer_name || '-'}<br>
              Durum: ${order.status} / ${order.fulfillment_status || '-'}<br>
              Pick: ${order.pick_status || 'Yok'}
            </div>
            ${order.wix_order_id ? `<div class="wix-id">Wix ID: ${order.wix_order_id}</div>` : '<div style="color: #ef4444; font-size: 11px;">Wix ID yok</div>'}
          </div>
        `).join('')}
      </div>
    `;
    
    $('#ordersResult').innerHTML = ordersHtml;
    $('#wmsOrdersContainer').innerHTML = ordersHtml;
    
  } catch (error) {
    console.error('Error loading orders:', error);
    $('#ordersResult').innerHTML = `<div class="result error">Hata: ${error.message}</div>`;
  } finally {
    $('#loadOrders').disabled = false;
    $('#loadOrders').textContent = 'SipariÅŸleri YÃ¼kle';
  }
}

// Select order for testing
function selectOrder(orderId, orderNumber, wixOrderId) {
  if (wixOrderId) {
    $('#orderId').value = wixOrderId;
    console.log(`ğŸ“¦ Selected order: ${orderNumber} (WMS ID: ${orderId}, Wix ID: ${wixOrderId})`);
  } else {
    alert(`SipariÅŸ ${orderNumber} iÃ§in Wix ID bulunamadÄ±!`);
  }
}

// Manual Wix test form
$('#wixTestForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const orderId = $('#orderId').value.trim();
  const fulfillmentStatus = $('#fulfillmentStatus').value;
  
  if (!orderId || !fulfillmentStatus) {
    alert('Order ID ve Fulfillment Status gerekli!');
    return;
  }
  
  const submitBtn = $('#wixTestForm button');
  submitBtn.disabled = true;
  submitBtn.textContent = 'GÃ¶nderiliyor...';
  
  try {
    console.log('ğŸ§ª Testing Wix update:', { orderId, fulfillmentStatus });
    
    const response = await fetch('/api/test/wix/order-fulfillment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ orderId, fulfillmentStatus })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      $('#testResult').innerHTML = `
        <div class="result success">
          âœ… BaÅŸarÄ±lÄ±!
          
          ${JSON.stringify(result, null, 2)}
        </div>
      `;
      console.log('âœ… Wix test successful:', result);
    } else {
      throw new Error(result.error || 'Bilinmeyen hata');
    }
    
  } catch (error) {
    console.error('âŒ Wix test error:', error);
    $('#testResult').innerHTML = `
      <div class="result error">
        âŒ Hata: ${error.message}
        
        ${error.response ? JSON.stringify(error.response, null, 2) : ''}
      </div>
    `;
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Wix\'te GÃ¼ncelle';
  }
});

// Load orders on page load
$('#loadOrders').addEventListener('click', loadWMSOrders);

// Auto-load orders
setTimeout(() => {
  loadWMSOrders();
}, 500);

// Mobile navigation toggle
document.getElementById('mobileNavToggle').addEventListener('click', () => {
  const menu = document.getElementById('mobileNavMenu');
  menu.classList.toggle('show');
});

// Close mobile menu when clicking outside
document.addEventListener('click', (e) => {
  const nav = document.getElementById('mobileNav');
  const menu = document.getElementById('mobileNavMenu');
  if (!nav.contains(e.target)) {
    menu.classList.remove('show');
  }
});

</script>
</body>
</html>